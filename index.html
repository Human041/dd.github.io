<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row =>
                    row.some(cell => cell !== '' && cell !== null && cell !== undefined)
                );

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>紙張庫存管理系統</title>
    <style>
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .shelf-section {
            margin: 30px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f5f5f5;
        }
        .control-panel {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .error-msg {
            color: red;
            margin-left: 10px;
            font-weight: bold;
        }
        .log-section {
            margin-top: 30px;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
        }
        #logs div {
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        button {
            padding: 8px 12px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #0056b3;
        }
        input, select {
            padding: 6px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }
        .search-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #fff;
        }
        .batch-buttons {
            margin: 10px 0;
        }
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
        }
        @media (max-width: 600px) {
            .control-panel, .form-container, .search-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="loginPage" class="login-container">
        <div class="login-form">
            <h2>紙張庫存管理系統 - 登入</h2>
            <input type="text" id="username" placeholder="帳號">
            <input type="password" id="password" placeholder="密碼">
            <button onclick="login()">登入</button>
            <span id="loginError" class="error-msg"></span>
        </div>
    </div>
    <div id="mainPage" class="container" style="display:none;">
        <!-- 操作面板 -->
        <div class="control-panel">
            <button onclick="showAddForm()">新增紙種</button>
            <button onclick="showDeleteForm()">刪除紙種</button>
            <button onclick="showTransferForm()">調動紙種</button>
            <button onclick="showBatchDeleteForm()">批次刪除</button>
            <button onclick="showBatchTransferForm()">批次調動</button>
            <button onclick="logout()">登出</button>
        </div>

        <!-- 新增表單 -->
        <div id="addForm" style="display:none;" class="form-container">
            <input type="text" id="newName" placeholder="紙種名稱">
            <input type="text" id="newSize" placeholder="尺寸">
            <input type="number" id="newQty" placeholder="數量" min="0">
            <select id="newShelf">
                <option value="1">貨架一</option>
                <option value="2">貨架二</option>
                <option value="3">貨架三</option>
                <option value="4">貨架四</option>
                <option value="5">貨架五</option>
            </select>
            <button onclick="addPaper()">確認</button>
            <span id="addError" class="error-msg"></span>
        </div>

        <!-- 刪除表單 -->
        <div id="deleteForm" style="display:none;" class="form-container">
            <select id="delShelf">
                <option value="1">貨架一</option>
                <option value="2">貨架二</option>
                <option value="3">貨架三</option>
                <option value="4">貨架四</option>
                <option value="5">貨架五</option>
            </select>
            <input type="text" id="delName" placeholder="紙種名稱">
            <input type="text" id="delSize" placeholder="尺寸">
            <button onclick="confirmDelete()">刪除</button>
            <span id="delConfirm" class="error-msg"></span>
        </div>

        <!-- 調動表單 -->
        <div id="transferForm" style="display:none;" class="form-container">
            <select id="fromShelf">
                <option value="1">貨架一</option>
                <option value="2">貨架二</option>
                <option value="3">貨架三</option>
                <option value="4">貨架四</option>
                <option value="5">貨架五</option>
            </select>
            <input type="text" id="transferName" placeholder="紙種名稱">
            <input type="text" id="transferSize" placeholder="尺寸">
            <input type="number" id="transferQty" placeholder="調動數量" min="1">
            <select id="toShelf">
                <option value="1">貨架一</option>
                <option value="2">貨架二</option>
                <option value="3">貨架三</option>
                <option value="4">貨架四</option>
                <option value="5">貨架五</option>
            </select>
            <button onclick="transferPaper()">確認調動</button>
            <span id="transferError" class="error-msg"></span>
        </div>

        <!-- 批次刪除表單 -->
        <div id="batchDeleteForm" style="display:none;" class="form-container">
            <select id="batchDelShelf">
                <option value="1">貨架一</option>
                <option value="2">貨架二</option>
                <option value="3">貨架三</option>
                <option value="4">貨架四</option>
                <option value="5">貨架五</option>
            </select>
            <button onclick="batchDelete()">確認批次刪除</button>
            <span id="batchDelError" class="error-msg"></span>
        </div>

        <!-- 批次調動表單 -->
        <div id="batchTransferForm" style="display:none;" class="form-container">
            <select id="batchFromShelf">
                <option value="1">貨架一</option>
                <option value="2">貨架二</option>
                <option value="3">貨架三</option>
                <option value="4">貨架四</option>
                <option value="5">貨架五</option>
            </select>
            <select id="batchToShelf">
                <option value="1">貨架一</option>
                <option value="2">貨架二</option>
                <option value="3">貨架三</option>
                <option value="4">貨架四</option>
                <option value="5">貨架五</option>
            </select>
            <button onclick="batchTransfer()">確認批次調動</button>
            <span id="batchTransferError" class="error-msg"></span>
        </div>

        <!-- 貨架表格 -->
        <div class="shelf-section" id="shelves"></div>

        <!-- 操作記錄 -->
        <div class="log-section">
            <h3>操作記錄（最近50筆）</h3>
            <div class="search-container">
                <input type="date" id="startDate" placeholder="開始日期">
                <input type="date" id="endDate" placeholder="結束日期">
                <input type="text" id="searchName" placeholder="紙種名稱">
                <button onclick="searchLogs()">搜索</button>
                <button onclick="resetLogs()">重置</button>
                <span id="searchError" class="error-msg"></span>
            </div>
            <div id="logs"></div>
        </div>
    </div>

    <script>
        // 戶
        const users = {
            'f': 'f',
            'x': 'x',
            'u': 'u'
        };

        // 檢查是否已登入
        function checkLogin() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn === 'true') {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainPage').style.display = 'block';
            } else {
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainPage').style.display = 'none';
            }
        }

        // 登入功能
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const loginError = document.getElementById('loginError');

            if (!username || !password) {
                loginError.innerText = '請輸入帳號和密碼！';
                return;
            }

            if (users[username] && users[username] === password) {
                localStorage.setItem('isLoggedIn', 'true');
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainPage').style.display = 'block';
                loginError.innerText = '';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            } else {
                loginError.innerText = '帳號或密碼錯誤！';
            }
        }

        // 登出功能
        function logout() {
            localStorage.setItem('isLoggedIn', 'false');
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainPage').style.display = 'none';
            hideAllForms();
        }

        let shelvesData = {
            1: { items: [], sortOrder: 'desc' },
            2: { items: [], sortOrder: 'desc' },
            3: { items: [], sortOrder: 'desc' },
            4: { items: [], sortOrder: 'desc' },
            5: { items: [], sortOrder: 'desc' }
        };
        let originalData = { 1: [], 2: [], 3: [], 4: [], 5: [] };
        let logs = [];
        let allLogs = [];

        // 初始化貨架表格
        function initShelves() {
            let html = '';
            for (let i = 1; i <= 5; i++) {
                html += `
                <div>
                    <h3>貨架${i}</h3>
                    <div class="control-panel">
                        <button onclick="sortTable(${i}, 'name')">名稱排序</button>
                        <button onclick="sortTable(${i}, 'size')">尺寸排序</button>
                        <button onclick="sortTable(${i}, 'qty')">數量排序</button>
                        <button onclick="clearSort(${i})">清除排序</button>
                        <button onclick="selectAll(${i})">全選</button>
                        <button onclick="deselectAll(${i})">取消全選</button>
                    </div>
                    <table id="shelf${i}">
                        <tr>
                            <th><input type="checkbox" id="selectAll${i}" onclick="selectAll(${i})"></th>
                            <th>名稱</th>
                            <th>尺寸</th>
                            <th>數量 (張)</th>
                            <th>調整數量</th>
                        </tr>
                    </table>
                </div>`;
            }
            document.getElementById('shelves').innerHTML = html;
        }

        // 驗證輸入
        function validateInput(name, size, qty) {
            if (!name || !size || qty === '' || isNaN(qty) || qty < 0) {
                return '請填寫所有欄位，且數量必須為非負數！';
            }
            return '';
        }

        // 新增紙種功能
        function addPaper() {
            const newItem = {
                name: document.getElementById('newName').value.trim(),
                size: document.getElementById('newSize').value.trim(),
                qty: parseInt(document.getElementById('newQty').value, 10),
                shelf: document.getElementById('newShelf').value
            };

            const error = validateInput(newItem.name, newItem.size, newItem.qty);
            if (error) {
                document.getElementById('addError').innerText = error;
                return;
            }

            if (checkDuplicate(newItem)) {
                document.getElementById('addError').innerText = '有相同紙種，請修改名稱或尺寸！';
                return;
            }

            shelvesData[newItem.shelf].items.push(newItem);
            originalData[newItem.shelf].push({ ...newItem });
            updateTable(newItem.shelf);
            addLog(newItem.shelf, newItem, '新增', 0, newItem.qty);
            saveData();
            clearForm('add');
        }

        // 刪除確認功能
        function confirmDelete() {
            const delInfo = {
                shelf: document.getElementById('delShelf').value,
                name: document.getElementById('delName').value.trim(),
                size: document.getElementById('delSize').value.trim()
            };

            const error = validateInput(delInfo.name, delInfo.size, 0);
            if (error) {
                document.getElementById('delConfirm').innerText = '請填寫名稱和尺寸！';
                return;
            }

            const itemIndex = shelvesData[delInfo.shelf].items.findIndex(
                item => item.name === delInfo.name && item.size === delInfo.size
            );
            if (itemIndex === -1) {
                document.getElementById('delConfirm').innerText = '找不到指定紙種！';
                return;
            }

            if (confirm(`確定刪除 ${delInfo.name} (${delInfo.size}) 嗎？`)) {
                const deletedItem = shelvesData[delInfo.shelf].items.splice(itemIndex, 1)[0];
                originalData[delInfo.shelf] = originalData[delInfo.shelf].filter(
                    item => !(item.name === delInfo.name && item.size === delInfo.size)
                );
                updateTable(delInfo.shelf);
                addLog(delInfo.shelf, deletedItem, '刪除', deletedItem.qty, 0);
                saveData();
                clearForm('delete');
            }
        }

        // 調動紙種功能
        function transferPaper() {
            const transferInfo = {
                fromShelf: document.getElementById('fromShelf').value,
                toShelf: document.getElementById('toShelf').value,
                name: document.getElementById('transferName').value.trim(),
                size: document.getElementById('transferSize').value.trim(),
                qty: parseInt(document.getElementById('transferQty').value, 10)
            };

            if (transferInfo.fromShelf === transferInfo.toShelf) {
                document.getElementById('transferError').innerText = '不能在同一貨架間調動！';
                return;
            }
            const error = validateInput(transferInfo.name, transferInfo.size, transferInfo.qty);
            if (error) {
                document.getElementById('transferError').innerText = error;
                return;
            }
            if (transferInfo.qty <= 0) {
                document.getElementById('transferError').innerText = '調動數量必須大於0！';
                return;
            }

            const fromItemIndex = shelvesData[transferInfo.fromShelf].items.findIndex(
                item => item.name === transferInfo.name && item.size === transferInfo.size
            );
            if (fromItemIndex === -1) {
                document.getElementById('transferError').innerText = '來源貨架找不到指定紙種！';
                return;
            }

            const fromItem = shelvesData[transferInfo.fromShelf].items[fromItemIndex];
            if (fromItem.qty < transferInfo.qty) {
                document.getElementById('transferError').innerText = '來源貨架數量不足！';
                return;
            }

            const toItemIndex = shelvesData[transferInfo.toShelf].items.findIndex(
                item => item.name === transferInfo.name && item.size === transferInfo.size
            );

            fromItem.qty -= transferInfo.qty;
            if (toItemIndex !== -1) {
                shelvesData[transferInfo.toShelf].items[toItemIndex].qty += transferInfo.qty;
            } else {
                shelvesData[transferInfo.toShelf].items.push({
                    name: transferInfo.name,
                    size: transferInfo.size,
                    qty: transferInfo.qty
                });
                originalData[transferInfo.toShelf].push({
                    name: transferInfo.name,
                    size: transferInfo.size,
                    qty: transferInfo.qty
                });
            }

            if (fromItem.qty === 0) {
                shelvesData[transferInfo.fromShelf].items.splice(fromItemIndex, 1);
                originalData[transferInfo.fromShelf] = originalData[transferInfo.fromShelf].filter(
                    item => !(item.name === transferInfo.name && item.size === transferInfo.size)
                );
            }

            updateTable(transferInfo.fromShelf);
            updateTable(transferInfo.toShelf);
            addLog(transferInfo.fromShelf, transferInfo, '調出', transferInfo.qty, -transferInfo.qty);
            addLog(transferInfo.toShelf, transferInfo, '調入', 0, transferInfo.qty);
            saveData();
            clearForm('transfer');
        }

        // 批次刪除功能
        function batchDelete() {
            const shelfNum = document.getElementById('batchDelShelf').value;
            const checkboxes = document.querySelectorAll(`#shelf${shelfNum} input[type="checkbox"]:not(#selectAll${shelfNum})`);
            const selectedIndices = [];

            checkboxes.forEach((checkbox, index) => {
                if (checkbox.checked) {
                    selectedIndices.push(index);
                }
            });

            if (selectedIndices.length === 0) {
                document.getElementById('batchDelError').innerText = '請至少選擇一項！';
                return;
            }

            if (confirm(`確定刪除 ${selectedIndices.length} 項紙種嗎？`)) {
                selectedIndices.sort((a, b) => b - a); // 從後往前刪除以避免索引問題
                selectedIndices.forEach(index => {
                    const deletedItem = shelvesData[shelfNum].items.splice(index, 1)[0];
                    originalData[shelfNum] = originalData[shelfNum].filter(
                        item => !(item.name === deletedItem.name && item.size === deletedItem.size)
                    );
                    addLog(shelfNum, deletedItem, '批次刪除', deletedItem.qty, 0);
                });
                updateTable(shelfNum);
                saveData();
                document.getElementById('batchDelError').innerText = '';
                hideAllForms();
            }
        }

        // 批次調動功能
        function batchTransfer() {
            const fromShelf = document.getElementById('batchFromShelf').value;
            const toShelf = document.getElementById('batchToShelf').value;
            const checkboxes = document.querySelectorAll(`#shelf${fromShelf} input[type="checkbox"]:not(#selectAll${fromShelf})`);
            const selectedIndices = [];

            if (fromShelf === toShelf) {
                document.getElementById('batchTransferError').innerText = '不能在同一貨架間調動！';
                return;
            }

            checkboxes.forEach((checkbox, index) => {
                if (checkbox.checked) {
                    selectedIndices.push(index);
                }
            });

            if (selectedIndices.length === 0) {
                document.getElementById('batchTransferError').innerText = '請至少選擇一項！';
                return;
            }

            if (confirm(`確定將 ${selectedIndices.length} 項紙種從貨架${fromShelf}調動到貨架${toShelf}嗎？`)) {
                selectedIndices.forEach(index => {
                    const item = shelvesData[fromShelf].items[index];
                    const toItemIndex = shelvesData[toShelf].items.findIndex(
                        toItem => toItem.name === item.name && toItem.size === item.size
                    );

                    if (toItemIndex !== -1) {
                        shelvesData[toShelf].items[toItemIndex].qty += item.qty;
                    } else {
                        shelvesData[toShelf].items.push({ ...item });
                        originalData[toShelf].push({ ...item });
                    }

                    addLog(fromShelf, item, '批次調出', item.qty, -item.qty);
                    addLog(toShelf, item, '批次調入', 0, item.qty);
                });

                // 移除來源貨架的項目
                selectedIndices.sort((a, b) => b - a);
                selectedIndices.forEach(index => {
                    shelvesData[fromShelf].items.splice(index, 1);
                });
                originalData[fromShelf] = originalData[fromShelf].filter(
                    item => !selectedIndices.some(idx => 
                        shelvesData[fromShelf].items[idx]?.name === item.name && 
                        shelvesData[fromShelf].items[idx]?.size === item.size)
                );

                updateTable(fromShelf);
                updateTable(toShelf);
                saveData();
                document.getElementById('batchTransferError').innerText = '';
                hideAllForms();
            }
        }

        // 表格更新
        function updateTable(shelfNum) {
            const table = document.getElementById(`shelf${shelfNum}`);
            let rows = '<tr><th><input type="checkbox" id="selectAll' + shelfNum + '" onclick="selectAll(' + shelfNum + ')"></th><th>名稱</th><th>尺寸</th><th>數量</th><th>調整數量</th></tr>';
            shelvesData[shelfNum].items.forEach((item, index) => {
                rows += `<tr>
                    <td><input type="checkbox" class="item-checkbox" id="checkbox${shelfNum}_${index}"></td>
                    <td>${item.name}</td>
                    <td>${item.size}</td>
                    <td>${item.qty} 張</td>
                    <td>
                        <input type="number" id="adjustQty${shelfNum}_${index}" placeholder="輸入調整數量" style="width: 100px;">
                        <button onclick="adjustQuantity(${shelfNum}, ${index})">確定</button>
                    </td>
                </tr>`;
            });
            table.innerHTML = rows;
        }

        // 全選功能
        function selectAll(shelfNum) {
            const selectAllCheckbox = document.getElementById(`selectAll${shelfNum}`);
            const checkboxes = document.querySelectorAll(`#shelf${shelfNum} .item-checkbox`);
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        }

        // 取消全選
        function deselectAll(shelfNum) {
            const selectAllCheckbox = document.getElementById(`selectAll${shelfNum}`);
            const checkboxes = document.querySelectorAll(`#shelf${shelfNum} .item-checkbox`);
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            selectAllCheckbox.checked = false;
        }

        // 排序功能
        function sortTable(shelfNum, type) {
            const shelfData = shelvesData[shelfNum].items;
            const currentOrder = shelvesData[shelfNum].sortOrder;

            shelfData.sort((a, b) => {
                let comparison = 0;
                if (type === 'name') {
                    comparison = a.name.localeCompare(b.name);
                } else if (type === 'size') {
                    comparison = a.size.localeCompare(b.size);
                } else if (type === 'qty') {
                    comparison = a.qty - b.qty;
                }
                return currentOrder === 'asc' ? comparison : -comparison;
            });

            shelvesData[shelfNum].sortOrder = currentOrder === 'asc' ? 'desc' : 'asc';
            updateTable(shelfNum);
        }

        // 清除排序
        function clearSort(shelfNum) {
            shelvesData[shelfNum].items = [...originalData[shelfNum]];
            shelvesData[shelfNum].sortOrder = 'desc';
            updateTable(shelfNum);
        }

        // 檢查重複
        function checkDuplicate(newItem) {
            return shelvesData[newItem.shelf].items.some(
                item => item.name === newItem.name && item.size === newItem.size
            );
        }

        // 添加操作記錄
        function addLog(shelfNum, item, action, originalQty, newQty) {
            const timestamp = new Date().toLocaleString();
            let message = '';
            if (action === '新增') {
                message = `貨架${shelfNum}：新增 ${item.name} (${item.size})，數量 ${newQty} 張，時間：${timestamp}`;
            } else if (action === '刪除' || action === '批次刪除') {
                message = `貨架${shelfNum}：${action} ${item.name} (${item.size})，原數量 ${originalQty} 張，時間：${timestamp}`;
            } else if (action === '調整') {
                const change = newQty >= 0 ? `增加 ${newQty}` : `減少 ${Math.abs(newQty)}`;
                message = `貨架${shelfNum}：${item.name} (${item.size}) 原數量 ${originalQty} 張，${change} 張，現數量 ${item.qty} 張，時間：${timestamp}`;
            } else if (action === '調出' || action === '批次調出') {
                message = `貨架${shelfNum}：${action} ${item.name} (${item.size})，數量 ${originalQty} 張，時間：${timestamp}`;
            } else if (action === '調入' || action === '批次調入') {
                message = `貨架${shelfNum}：${action} ${item.name} (${item.size})，數量 ${newQty} 張，時間：${timestamp}`;
            }
            allLogs.unshift({ message, timestamp: new Date() });
            logs = allLogs.slice(0, 50);
            updateLogs();
        }

        // 更新操作記錄顯示
        function updateLogs() {
            const logContainer = document.getElementById('logs');
            logContainer.innerHTML = logs.map(log => `<div>${log.message}</div>`).join('');
        }

        // 搜索操作記錄
        function searchLogs() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const searchName = document.getElementById('searchName').value.trim().toLowerCase();
            const searchError = document.getElementById('searchError');

            if (startDate && endDate && new Date(startDate) > new Date(endDate)) {
                searchError.innerText = '開始日期不能晚於結束日期！';
                return;
            }

            logs = allLogs.filter(log => {
                const logDate = new Date(log.timestamp);
                const start = startDate ? new Date(startDate) : null;
                const end = endDate ? new Date(endDate) : null;
                const nameMatch = searchName ? log.message.toLowerCase().includes(searchName) : true;
                const dateMatch = (!start || logDate >= start) && (!end || logDate <= new Date(end.setHours(23, 59, 59, 999)));
                return nameMatch && dateMatch;
            });

            if (logs.length === 0) {
                searchError.innerText = '無符合條件的記錄！';
            } else {
                searchError.innerText = '';
            }

            logs = logs.slice(0, 50);
            updateLogs();
        }

        // 重置操作記錄顯示
        function resetLogs() {
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('searchName').value = '';
            document.getElementById('searchError').innerText = '';
            logs = allLogs.slice(0, 50);
            updateLogs();
        }

        // 顯示/隱藏表單
        function showAddForm() {
            hideAllForms();
            document.getElementById('addForm').style.display = 'flex';
        }

        function showDeleteForm() {
            hideAllForms();
            document.getElementById('deleteForm').style.display = 'flex';
        }

        function showTransferForm() {
            hideAllForms();
            document.getElementById('transferForm').style.display = 'flex';
        }

        function showBatchDeleteForm() {
            hideAllForms();
            document.getElementById('batchDeleteForm').style.display = 'flex';
        }

        function showBatchTransferForm() {
            hideAllForms();
            document.getElementById('batchTransferForm').style.display = 'flex';
        }

        function hideAllForms() {
            document.getElementById('addForm').style.display = 'none';
            document.getElementById('deleteForm').style.display = 'none';
            document.getElementById('transferForm').style.display = 'none';
            document.getElementById('batchDeleteForm').style.display = 'none';
            document.getElementById('batchTransferForm').style.display = 'none';
        }

        // 清除表單內容
        function clearForm(formType) {
            if (formType === 'add') {
                document.getElementById('newName').value = '';
                document.getElementById('newSize').value = '';
                document.getElementById('newQty').value = '';
                document.getElementById('addError').innerText = '';
            } else if (formType === 'delete') {
                document.getElementById('delName').value = '';
                document.getElementById('delSize').value = '';
                document.getElementById('delConfirm').innerText = '';
            } else if (formType === 'transfer') {
                document.getElementById('transferName').value = '';
                document.getElementById('transferSize').value = '';
                document.getElementById('transferQty').value = '';
                document.getElementById('transferError').innerText = '';
            }
        }

        // 保存數據到 localStorage
        function saveData() {
            localStorage.setItem('shelvesData', JSON.stringify(shelvesData));
            localStorage.setItem('originalData', JSON.stringify(originalData));
            localStorage.setItem('allLogs', JSON.stringify(allLogs));
        }

        // 從 localStorage 加載數據
        function loadData() {
            const savedShelves = localStorage.getItem('shelvesData');
            const savedOriginal = localStorage.getItem('originalData');
            const savedLogs = localStorage.getItem('allLogs');
            if (savedShelves) shelvesData = JSON.parse(savedShelves);
            if (savedOriginal) originalData = JSON.parse(savedOriginal);
            if (savedLogs) {
                allLogs = JSON.parse(savedLogs);
                logs = allLogs.slice(0, 50);
            }
            for (let i = 1; i <= 5; i++) {
                updateTable(i);
            }
            updateLogs();
        }

        // 初始化測試數據
        function initTestData() {
            const testData = [
                { shelf: 1, name: '正度紙', size: '78.7*109.2cm', qty: 100 },
                { shelf: 2, name: 'A4紙', size: '21*29.7cm', qty: 200 },
                { shelf: 3, name: '銅版紙', size: '88*120cm', qty: 50 },
                { shelf: 4, name: '新聞紙', size: '54*78cm', qty: 300 },
                { shelf: 5, name: '牛皮紙', size: '75*110cm', qty: 80 }
            ];
            testData.forEach(item => {
                shelvesData[item.shelf].items.push(item);
                originalData[item.shelf].push({ ...item });
                addLog(item.shelf, item, '新增', 0, item.qty);
            });
            for (let i = 1; i <= 5; i++) {
                updateTable(i);
            }
            saveData();
        }

        // 調整數量
        function adjustQuantity(shelfNum, index) {
            const adjustInput = document.getElementById(`adjustQty${shelfNum}_${index}`);
            const adjustValue = parseInt(adjustInput.value, 10);

            if (isNaN(adjustValue)) {
                alert('請輸入有效的數字！');
                return;
            }

            const item = shelvesData[shelfNum].items[index];
            const originalQty = item.qty;
            item.qty += adjustValue;
            if (item.qty < 0) {
                alert('數量不能小於0！');
                item.qty = originalQty;
                return;
            }
            updateTable(shelfNum);
            addLog(shelfNum, item, '調整', originalQty, adjustValue);
            saveData();
            adjustInput.value = '';
        }

        // 頁面加載時初始化
        window.onload = function() {
            checkLogin();
            initShelves();
            if (localStorage.getItem('shelvesData')) {
                loadData();
            } else {
                initTestData();
            }
        };
    </script>
</body>
</html>
